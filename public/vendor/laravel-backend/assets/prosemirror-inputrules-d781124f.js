import{a as h}from"./prosemirror-state-ba2e3a6a.js";class f{constructor(l,e,t={}){this.match=l,this.match=l,this.handler=typeof e=="string"?m(e):e,this.undoable=t.undoable!==!1}}function m(r){return function(l,e,t,s){let n=r;if(e[1]){let u=e[0].lastIndexOf(e[1]);n+=e[0].slice(u+e[1].length),t+=u;let o=t-s;o>0&&(n=e[0].slice(u-o,u)+n,t=s)}return l.tr.insertText(n,t,s)}}const x=500;function I({rules:r}){let l=new h({state:{init(){return null},apply(e,t){let s=e.getMeta(this);return s||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,t,s,n){return g(e,t,s,n,r,l)},handleDOMEvents:{compositionend:e=>{setTimeout(()=>{let{$cursor:t}=e.state.selection;t&&g(e,t.pos,t.pos,"",r,l)})}}},isInputRules:!0});return l}function g(r,l,e,t,s,n){if(r.composing)return!1;let u=r.state,o=u.doc.resolve(l);if(o.parent.type.spec.code)return!1;let i=o.parent.textBetween(Math.max(0,o.parentOffset-x),o.parentOffset,null,"￼")+t;for(let p=0;p<s.length;p++){let c=s[p],d=c.match.exec(i),a=d&&c.handler(u,d,l-(d[0].length-t.length),e);if(a)return c.undoable&&a.setMeta(n,{transform:a,from:l,to:e,text:t}),r.dispatch(a),!0}return!1}const M=(r,l)=>{let e=r.plugins;for(let t=0;t<e.length;t++){let s=e[t],n;if(s.spec.isInputRules&&(n=s.getState(r))){if(l){let u=r.tr,o=n.transform;for(let i=o.steps.length-1;i>=0;i--)u.step(o.steps[i].invert(o.docs[i]));if(n.text){let i=u.doc.resolve(n.from).marks();u.replaceWith(n.from,n.to,r.schema.text(n.text,i))}else u.delete(n.from,n.to);l(u)}return!0}}return!1};new f(/--$/,"—");new f(/\.\.\.$/,"…");new f(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,"“");new f(/"$/,"”");new f(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,"‘");new f(/'$/,"’");export{f as I,I as i,M as u};
